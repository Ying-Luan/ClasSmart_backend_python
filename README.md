# CLasSmart 灵分 Python 部分

**CLasSmart 灵分** 是一款智能垃圾分类系统，用户通过上传待分类图片即可获取分类结果。本文档详细介绍了 Python 部分的实现与功能，该部分主要负责图像分类模型的训练与推理。

---

## 🖼️ 工作流程

Python 部分在系统中承担图像分类的核心功能，其工作流程如下：

1. **图片接收**：通过接口从 Java 后端接收待分类图片。
2. **模型推理**：利用预训练的 PyTorch 模型对图片进行分类处理。
3. **结果返回**：将分类结果通过接口返回至 Java 后端。

---

## ⏰ 定时任务

Python 部分目前不涉及定时任务的实现。模型的训练与更新由 Java 后端负责，通过上传新数据集触发复训练。

---

## 🔒 后端安全策略

作为后端服务，Python 部分的安全性由 Java 后端统一管理。Python 部分通过 API 与 Java 后端通信，依赖其安全机制保障数据传输与处理的可靠性。

---

## 🌐 分布式扩展性

Python 部分具备分布式部署能力，支持以下特性：

- **推理请求分发**：通过负载均衡器分配推理请求，提升系统吞吐量。
- **分布式训练**：支持在分布式环境中进行模型训练，充分利用硬件资源，加速训练过程。

---

## 🎯 模型复训练

Python 部分支持模型复训练以优化性能。Java 后端通过上传新数据集触发复训练，更新模型参数以提升分类准确性。

---

## 🔐 恶意图片识别

Python 部分集成恶意图片检测功能，利用 Autogen 等技术对上传图片进行分析，识别潜在恶意内容并采取相应处理措施。

---

## 🛠️ 技术栈

| 模块       | 技术/组件          |
|------------|--------------------|
| Python 部分 | PyTorch、Autogen、FastAPI |

---

## 🚀 部署指南

1. **环境准备**：安装 Python 3.10 + 及 requirements.txt 中列明的依赖。
2. **模型配置**：自行在 `model.py` 中定义模型并使用 `train.py` 进行预训练或者直接将预训练模型 net.pth 置于项目根目录。
3. **Autogen 配置**：自行在配置 `BASE_URL`、`OPENAI_API_KEY` 参数。
4. **服务启动**
   - **直接运行**：执行 `main.py` 文件启动服务。
   - **命令行运行**：

     ```shell
     uvicorn main:app --host 0.0.0.0 --port 8000
     ```

5. **API 调用**：通过 POST 请求访问 `/predict` 端点获取分类结果。

---

## 📂 文件介绍

| 文件             | 功能描述                     |
|------------------|------------------------------|
| `main.py`        | 主文件，用于启动系统         |
| `model.py`       | 模型定义文件，描述模型结构   |
| `train.py`       | 训练脚本，用于模型训练       |
| `utils.py`       | 工具函数文件，提供辅助功能   |
| `agent.py`       | 代理文件，用于调用 LLM API   |
| `classdata.json` | 类别映射文件，存储分类数据   |
| `net.pth`        | PyTorch 模型文件，用于加载模型 |
| `data0`          | 资源目录，存放预训练图片数据 |
| `requirements.txt` | 依赖清单，用于安装所需库   |

---

## 🔮 未来展望

Python 部分将持续优化，计划引入以下技术提升性能与扩展性：

- **模型优化**：采用更先进的模型架构，提高分类精度。
- **自动化训练**：实现模型训练与部署的自动化流程。
- **分布式训练**：利用分布式计算资源加速模型训练，提升效率。
